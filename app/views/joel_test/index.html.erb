<%
# Joel Test plugin for Redmine
# Copyright (C) 2010  Takashi Takebayashi
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-%>
<% html_title(l(:JoelTest)) -%>
<h2><%= l(:joel_test) %></h2>
<div class="joel_test-plugin">
  <%= link_to(l(:label_joel_on_software), l(:label_joel_on_software_url), {:popup => true}) %><%
unless (@target == nil) %>
  <p><%= l(:label_your_last_score) %> <%= @target.score %> <%= l(:label_score) %></p><%
end
unless (@all_target.length == 0) %>
  <p><%= l(:label_average_score) %> <%= @average_score %> <%= l(:label_score) %></p><%
end %>
  <% form_tag :action => "reply", :id => @project do %>
    <ol><%
# TODO 点数の遷移をグラフ表示する。
@question_of_joel_test.each_with_index {|label, index|  # ジョエルテストの質問を表示する処理
  if (@target != nil) %>
      <li><%= l(label) %><label><%= radio_button("question", (index + 1).to_s, "yes", {:checked => @target.answers[index] != 0 ? "checked" : "false"}) %>Yes</label><label><%= radio_button("question", (index + 1).to_s, "no", {:checked => @target.answers[index] != 1 ? "checked" : "false"}) %>No</label> Yes: <%= h(sprintf("%.2f", @average_answers[index]) + "%") if @all_target.length != 0 %></li><%
  else %>
      <li><%= l(label) %><label><%= radio_button("question", (index + 1).to_s, "yes") %>Yes</label><label><%= radio_button("question", (index + 1).to_s, "no") %>No</label> Yes: <%= h(sprintf("%.2f", @average_answers[index]) + "%") if @all_target.length != 0 %></li><%
  end
} %>
    </ol>
    <%= submit_tag l(:button_reply) %>
  <% end %>
</div>
